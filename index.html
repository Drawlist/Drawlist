<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Drawlist с кубом меню</title>

  <style>
    :root {
      --bg-color: white;
      --text-color: black;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg-color: #121212;
        --text-color: #f1f1f1;
      }
    }

    body {
      background-color: var(--bg-color);
      color: var(--text-color);
      margin: 0;
      padding-top: 60px;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: sans-serif;
      user-select: none;
      perspective: 800px; /* для 3D */
    }

    #topBanner {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 60px;
      background-color: #ccc;
      color: #333;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 24px;
      padding: 0 20px;
      z-index: 1000;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    #themeIcon {
      position: fixed;
      top: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      pointer-events: none;
      user-select: none;
      z-index: 1100;
    }

    /* КУБ */
    #cubeContainer {
      width: 320px;
      height: 200px;
      position: relative;
      transform-style: preserve-3d;
      transition: opacity 0.8s ease, transform 0.8s ease;
      margin-bottom: 30px;
    }

    #cubeContainer.hide {
      opacity: 0;
      transform: translateY(-50px) rotateX(45deg);
      pointer-events: none;
    }

    .cube-face {
      position: absolute;
      width: 320px;
      height: 200px;
      background: #4CAF50;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 30px;
      user-select: none;
      backface-visibility: hidden;
      padding: 20px;
      box-sizing: border-box;
    }

    /* лицевая грань куба — наша меню */
    #face-front {
      transform: translateZ(100px);
      background: #4CAF50;
    }

    /* Кнопки внутри меню куба */
    #face-front button {
      margin: 12px 8px 0;
      font-size: 18px;
      padding: 10px 25px;
      background-color: #2196F3;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: white;
      transition: background-color 0.3s ease;
      user-select: none;
    }

    #face-front button:hover {
      background-color: #1976D2;
    }

    #face-front p {
      margin: 0 0 15px;
      font-size: 36px;
      font-weight: 900;
      text-shadow: 1px 1px 3px rgba(0,0,0,0.3);
    }

    /* Контейнер рисования (изначально скрыт) */
    #drawArea {
      display: none;
      flex-direction: column;
      align-items: center;
      touch-action: none;
      width: 90vw;
      max-width: 800px;
    }

    canvas {
      width: 100%;
      height: auto;
      border: 2px solid #333;
      background: white;
      touch-action: none;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
      transform-origin: 0 0;
      border-radius: 8px;
    }

    label {
      margin-top: 10px;
      user-select: none;
      display: inline-block;
      margin-right: 15px;
    }

    input[type="text"], input[type="number"], select {
      padding: 3px 5px;
      font-size: 16px;
      border-radius: 3px;
      border: 1px solid #ccc;
      vertical-align: middle;
    }

    footer {
      margin-top: 20px;
      font-size: 14px;
      text-align: center;
      user-select: none;
    }

    @media (max-width: 600px) {
      #cubeContainer {
        width: 90vw;
        height: 150px;
      }

      .cube-face {
        width: 90vw;
        height: 150px;
        font-size: 24px;
      }

      #face-front button {
        font-size: 16px;
        padding: 8px 16px;
      }
    }
  </style>
</head>
<body>

  <div id="topBanner">Начни рисовать</div>
  <svg id="themeIcon" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg"></svg>

  <!-- Куб меню -->
  <div id="cubeContainer">
    <div class="cube-face" id="face-front">
      <p>drawlist</p>
      <button id="drawBtn">рисовать</button>
      <button id="authorsBtn">авторы</button>
    </div>
  </div>

  <!-- Зона рисования -->
  <div id="drawArea">
    <canvas id="canvas"></canvas>

    <label>
      Цвет:
      <input type="color" id="colorPicker" value="#000000" style="margin-left: 5px; width: 40px; height: 30px; border: none;">
    </label>

    <label>
      Толщина:
      <select id="lineWidthSelect" style="margin-left: 5px; padding: 5px;">
        <option value="2">Тонкая</option>
        <option value="5" selected>Средняя</option>
        <option value="10">Толстая</option>
      </select>
    </label>

    <label style="margin-top:10px;">
      Текст:
      <input type="text" id="textInput" placeholder="Введите текст" style="margin-left: 5px; width: 150px;">
    </label>

    <label>
      Шрифт:
      <select id="fontSelect" style="margin-left: 5px; padding: 5px;">
        <option value="Arial" selected>Arial</option>
        <option value="Times New Roman">Times New Roman</option>
        <option value="Courier New">Courier New</option>
        <option value="Georgia">Georgia</option>
        <option value="Verdana">Verdana</option>
      </select>
    </label>

    <label>
      Размер:
      <input type="number" id="fontSizeInput" value="24" min="8" max="72" style="width: 60px; margin-left: 5px; padding: 3px;">
    </label>

    <button id="eraserBtn">Ластик</button>
    <button id="clearBtn">Очистить</button>
    <button id="saveBtn">Скачать</button>
    <button id="resetViewBtn" style="background:#2196F3; margin-top:10px;">Сбросить масштаб</button>
  </div>

  <footer>
    © 2025 Все права защищены
  </footer>

<script>
  const cube = document.getElementById('cubeContainer');
  const drawBtn = document.getElementById('drawBtn');
  const authorsBtn = document.getElementById('authorsBtn');
  const drawArea = document.getElementById('drawArea');
  const canvas = document.getElementById('canvas');
  const clearBtn = document.getElementById('clearBtn');
  const eraserBtn = document.getElementById('eraserBtn');
  const saveBtn = document.getElementById('saveBtn');
  const resetViewBtn = document.getElementById('resetViewBtn');
  const colorPicker = document.getElementById('colorPicker');
  const lineWidthSelect = document.getElementById('lineWidthSelect');

  const textInput = document.getElementById('textInput');
  const fontSelect = document.getElementById('fontSelect');
  const fontSizeInput = document.getElementById('fontSizeInput');

  const topBanner = document.getElementById('topBanner');
  const themeIcon = document.getElementById('themeIcon');

  const ctx = canvas.getContext('2d');
  let drawing = false;
  let isErasing = false;

  // Зум и панорамирование
  let scale = 1;
  let originX = 0;
  let originY = 0;
  let lastTouchDistance = null;
  let isPanning = false;
  let panStart = { x: 0, y: 0 };

  // Режим текста
  let isTextMode = false;

  // Кнопка переключения режимов текст/рисование
  const textModeBtn = document.createElement('button');
  textModeBtn.textContent = 'Добавить текст';
  textModeBtn.style.marginTop = '10px';
  drawArea.insertBefore(textModeBtn, resetViewBtn);

  textModeBtn.addEventListener('click', () => {
    isTextMode = !isTextMode;
    if (isTextMode) {
      textModeBtn.textContent = 'Режим рисования';
      canvas.style.cursor = 'text';
    } else {
      textModeBtn.textContent = 'Добавить текст';
      canvas.style.cursor = 'crosshair';
    }
  });

  drawBtn.addEventListener('click', () => {
    // Анимация скрытия куба
    cube.classList.add('hide');

    // Через 800мс скрываем куб и показываем зону рисования
    setTimeout(() => {
      cube.style.display = 'none';
      drawArea.style.display = 'flex';
      topBanner.style.display = 'none'; // скрыть баннер
      resizeCanvas();
    }, 800);
  });

  authorsBtn.addEventListener('click', () => {
    alert('Авторы проекта:\n\n- Адиль Чуйтенов 1\n- Кубат Чуйтенов 2\n\nСпасибо за использование Drawlist!');
  });

  eraserBtn.addEventListener('click', () => {
    isErasing = !isErasing;
    eraserBtn.textContent = isErasing ? 'Рисовать' : 'Ластик';
  });

  canvas.addEventListener('mousedown', (e) => {
    if (isTextMode) return;
    drawing = true;
    ctx.beginPath();
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left - originX) / scale;
    const y = (e.clientY - rect.top - originY) / scale;
    ctx.moveTo(x, y);
  });

  canvas.addEventListener('mouseup', () => {
    drawing = false;
  });

  canvas.addEventListener('mouseout', () => {
    drawing = false;
  });

  canvas.addEventListener('mousemove', (e) => {
    if (!drawing || isTextMode) return;
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left - originX) / scale;
    const y = (e.clientY - rect.top - originY) / scale;
    drawAt(x, y);
  });

  canvas.addEventListener('click', (e) => {
    if (!isTextMode) return;

    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left - originX) / scale;
    const y = (e.clientY - rect.top - originY) / scale;

    const fontSize = parseInt(fontSizeInput.value, 10) || 24;
    const fontFamily = fontSelect.value || 'Arial';
    const text = textInput.value.trim();

    if (text === '') return;

    ctx.save();
    ctx.scale(1 / scale, 1 / scale);
    ctx.font = `${fontSize}px ${fontFamily}`;
    ctx.fillStyle = colorPicker.value;
    ctx.fillText(text, (x + originX) * scale, (y + originY) * scale);
    ctx.restore();

    isTextMode = false;
    textModeBtn.textContent = 'Добавить текст';
    canvas.style.cursor = 'crosshair';
  });

  canvas.addEventListener('touchstart', (e) => {
    if (e.touches.length === 1) {
      if (isTextMode) return;
      e.preventDefault();
      drawing = true;
      ctx.beginPath();
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches[0];
      const x = (touch.clientX - rect.left - originX) / scale;
      const y = (touch.clientY - rect.top - originY) / scale;
      ctx.moveTo(x, y);
    } else if (e.touches.length === 2) {
      e.preventDefault();
      lastTouchDistance = getTouchDistance(e.touches);
      isPanning = true;
      panStart.x = (e.touches[0].clientX + e.touches[1].clientX) / 2 - originX;
      panStart.y = (e.touches[0].clientY + e.touches[1].clientY) / 2 - originY;
    }
  });

  canvas.addEventListener('touchend', (e) => {
    if (e.touches.length < 2) {
      isPanning = false;
    }
    if (e.touches.length === 0) {
      drawing = false;
    }
  });

  canvas.addEventListener('touchmove', (e) => {
    if (e.touches.length === 1 && drawing) {
      if (isTextMode) return;
      e.preventDefault();
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches[0];
      const x = (touch.clientX - rect.left - originX) / scale;
      const y = (touch.clientY - rect.top - originY) / scale;
      drawAt(x, y);
    } else if (e.touches.length === 2 && isPanning) {
      e.preventDefault();
      const newDistance = getTouchDistance(e.touches);
      const zoomFactor = newDistance / lastTouchDistance;
      lastTouchDistance = newDistance;

      scale *= zoomFactor;
      scale = Math.max(0.5, Math.min(5, scale));

      const centerX = (e.touches[0].clientX + e.touches[1].clientX) / 2;
      const centerY = (e.touches[0].clientY + e.touches[1].clientY) / 2;

      originX = centerX - panStart.x;
      originY = centerY - panStart.y;

      applyTransform();
    }
  });

  function drawAt(x, y) {
    ctx.lineWidth = parseInt(lineWidthSelect.value, 10);
    ctx.lineCap = 'round';
    ctx.strokeStyle = isErasing ? '#ffffff' : colorPicker.value;

    ctx.lineTo(x, y);
    ctx.stroke();
    ctx.beginPath();
    ctx.moveTo(x, y);
  }

  clearBtn.addEventListener('click', () => {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
  });

  saveBtn.addEventListener('click', () => {
    const link = document.createElement('a');
    link.download = 'drawlist.png';
    link.href = canvas.toDataURL();
    link.click();
  });

  resetViewBtn.addEventListener('click', () => {
    scale = 1;
    originX = 0;
    originY = 0;
    applyTransform();
  });

  function getTouchDistance(touches) {
    const dx = touches[0].clientX - touches[1].clientX;
    const dy = touches[0].clientY - touches[1].clientY;
    return Math.sqrt(dx * dx + dy * dy);
  }

  function applyTransform() {
    canvas.style.transform = `translate(${originX}px, ${originY}px) scale(${scale})`;
    canvas.style.transformOrigin = '0 0';
  }

  function resizeCanvas() {
    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientWidth * 3 / 4;
    applyTransform();
  }

  window.addEventListener('resize', resizeCanvas);
  window.addEventListener('load', resizeCanvas);

  // --------- Тема и иконка ---------

  function updateThemeIcon() {
    const isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (isDark) {
      themeIcon.innerHTML = `
        <circle cx="32" cy="32" r="15" fill="#f0e68c"/>
        <circle cx="40" cy="28" r="15" fill="${getComputedStyle(document.body).backgroundColor}"/>
      `;
    } else {
      themeIcon.innerHTML = `
        <circle cx="32" cy="32" r="12" fill="#FFD93B"/>
        <g stroke="#FFD93B" stroke-width="3">
          <line x1="32" y1="4" x2="32" y2="16"/>
          <line x1="32" y1="48" x2="32" y2="60"/>
          <line x1="4" y1="32" x2="16" y2="32"/>
          <line x1="48" y1="32" x2="60" y2="32"/>
          <line x1="12" y1="12" x2="20" y2="20"/>
          <line x1="44" y1="44" x2="52" y2="52"/>
          <line x1="12" y1="52" x2="20" y2="44"/>
          <line x1="44" y1="20" x2="52" y2="12"/>
        </g>
      `;
    }
  }

  updateThemeIcon();
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', updateThemeIcon);
</script>

</body>
</html>
